<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Orbit Demo</title>
  <script src="https://cdn.plot.ly/plotly-2.25.2.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 20px; }
    #controls { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px; }
    .ctrl { display: flex; flex-direction: column; }
    .ctrl label { margin-bottom: 5px; }
  </style>
</head>
<body>

<h1>Interactive Kepler Orbit (3D + 2D)</h1>

<div id="controls">
  <div class="ctrl">
    <label for="slider-e">Eccentricity e</label>
    <input id="slider-e" type="range" min="0" max="0.9" step="0.01" value="0.1">
    <span id="val-e">0.10</span>
  </div>
  <div class="ctrl">
    <label for="slider-i">Inclination i (°)</label>
    <input id="slider-i" type="range" min="0" max="90" step="1" value="45">
    <span id="val-i">45</span>
  </div>
  <div class="ctrl">
    <label for="slider-ω">Argument of Periapsis ω (°)</label>
    <input id="slider-ω" type="range" min="0" max="360" step="1" value="90">
    <span id="val-ω">90</span>
  </div>
  <div class="ctrl">
    <label for="slider-Ω">Long. of Asc. Node Ω (°)</label>
    <input id="slider-Ω" type="range" min="0" max="360" step="1" value="90">
    <span id="val-Ω">90</span>
  </div>
</div>

<div id="plot" style="width:100%;height:600px;"></div>

<script>
// === Helper: compute 3D coords for true anomaly array f ===
function kepler3D(a,e,i,omega,Omega,f) {
  const Rz = th => [
    [Math.cos(th), -Math.sin(th), 0],
    [Math.sin(th),  Math.cos(th), 0],
    [0,             0,            1],
  ];
  const Rx = th => [
    [1, 0,             0],
    [0, Math.cos(th), -Math.sin(th)],
    [0, Math.sin(th),  Math.cos(th)],
  ];
  // Combined rotation R = Rz(Ω)·Rx(i)·Rz(ω)
  const R1 = Rz(Omega), R2 = Rx(i), R3 = Rz(omega);
  const R = math.multiply(R1, math.multiply(R2, R3)); // using math.js for mult
  const X=[], Y=[], Z=[];
  for(let k=0;k<f.length;k++){
    const r = a*(1-e*e)/(1+e*Math.cos(f[k]));
    const pf = [r*Math.cos(f[k]), r*Math.sin(f[k]), 0];
    const [x,y,z] = math.multiply(R, pf);
    X.push(x); Y.push(y); Z.push(z);
  }
  return {X,Y,Z};
}

// prepare math.js for matrix ops
const script = document.createElement('script');
script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.8.0/math.min.js';
script.onload = init;
document.head.appendChild(script);

function init(){
  const N = 400;
  const f = Array.from({length:N},(_,k)=>2*Math.PI*k/N);

  // Sliders & value displays
  const sliders = ['e','i','ω','Ω'].map(id=>document.getElementById('slider-'+id));
  const displays= ['e','i','ω','Ω'].map(id=>document.getElementById('val-'+id));

  function updatePlot(){
    const e     = parseFloat(sliders[0].value);
    const i_deg = parseFloat(sliders[1].value);
    const w_deg = parseFloat(sliders[2].value);
    const W_deg = parseFloat(sliders[3].value);
    displays[0].textContent = e.toFixed(2);
    displays[1].textContent = i_deg;
    displays[2].textContent = w_deg;
    displays[3].textContent = W_deg;

    const a = 1.0;
    const inc   = i_deg*Math.PI/180;
    const omega = w_deg*Math.PI/180;
    const Omega = W_deg*Math.PI/180;
    const {X,Y,Z} = kepler3D(a,e,inc,omega,Omega,f);

    // 3D trace
    const trace3d = {
      x: X, y: Y, z: Z,
      mode:'lines', type:'scatter3d',
      line:{color:'gray',width:2},
      name:'Orbit 3D'
    };
    // 2D trace
    const trace2d = {
      x: X, y: Y,
      mode:'lines', type:'scatter',
      line:{color:'gray',width:2},
      xaxis:'x2', yaxis:'y2',
      name:'Orbit 2D'
    };

    const layout = {
      title:'Interactive Orbit',
      scene:{domain:{x:[0,0.45],y:[0,1]}},
      xaxis2:{domain:[0.55,1],anchor:'y2',autorange:'reversed'},
      yaxis2:{domain:[0,1],anchor:'x2'},
      margin:{l:0,r:0,t:30,b:0}
    };

    Plotly.react('plot',[trace3d,trace2d],layout);
  }

  // attach events
  sliders.forEach(s=>s.addEventListener('input',updatePlot));
  // first draw
  updatePlot();
}
</script>

</body>
</html>
